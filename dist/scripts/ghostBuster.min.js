/*!
 Search plugin for ghost
 @author: Rui Molefas
 @email: rui@cloudoki.com
 @url: http://blog.cloudoki.com
 @version: 1.0.0
*/
!function(a){a.fn.ghostBuster=function(c){var d=a.extend({},a.fn.ghostBuster.defaults,c);return d.results?(b.init(this,d),b):void 0},a.fn.ghostBuster.defaults={results:!1,rss:"/rss",onKeyUp:!1,info_template:"<p id='num-results'>Number of posts found: {{amount}}</p>",displaySearchInfo:!0,zeroResultsInfo:!0,before:!1,onComplete:!1,result_template:'<article class="post"> 								    <header class="post-header"> 								        <h2 class="post-title"><a href="{{link}}">{{title}}</a></h2> 								    </header> 								    <section class="post-excerpt"> 								        <p>{{description}}<a class="read-more" href="{{link}}">Â»</a></p> 								    </section> 								    <footer class="post-meta"> 								        <a href="#">{{author}}</a> 								        <time class="post-date" datetime="{{pubDate}}">{{pubDate}}</time> 								    </footer> 								</article>'};var b={isInit:!1,init:function(b,c){var d=this;this.target=b,this.rss=c.rss,this.results=c.results,this.path=c.path,this.direct=c.direct,this.blogData=[],this.result_template=c.result_template,this.info_template=c.info_template,this.zeroResultsInfo=c.zeroResultsInfo,this.displaySearchInfo=c.displaySearchInfo,this.before=c.before,this.onComplete=c.onComplete,this.index=lunr(function(){this.field("title",{boost:10}),this.field("description"),this.field("author"),this.field("link"),this.field("category"),this.field("pubDate"),this.ref("id")}),b.focus(function(){d.loadRSS()}),b.closest("form").submit(function(a){a.preventDefault(),d.find(b.val())}),a(this.direct).closest("form").submit(function(b){b.preventDefault();var c=a(d.direct).val();window.location.replace(window.location.origin+d.path+"?"+c)}),c.onKeyUp&&(d.loadRSS(),b.keyup(function(){d.find(b.val())})),window.location.pathname==this.path&&this.makeSearch()},makeSearch:function(){var a=window.location.href.split("?");a.length>=2&&(this.target.val(decodeURI(a[1])),this.loadRSS(this.find.bind(this,decodeURI(a[1]))))},loadRSS:function(b){if(this.isInit)return!1;var c=this.index,d=this.rss,e=this.blogData;a.get(d,function(d){for(var f=a(d).find("item"),g=0;f&&g<f.length;g++){var h=f.eq(g),i={id:g+1,title:h.find("title").text(),description:h.find("description").text(),category:h.find("category").text(),pubDate:h.find("pubDate").text(),link:h.find("link").text(),author:h.find("author").text()};c.add(i),e.push(i)}b&&b()}),this.isInit=!0},find:function(b){var c=this.index.search(b),d=a(this.results),e=[];d.empty(),this.before&&this.before(),(this.zeroResultsInfo||c.length>0)&&this.displaySearchInfo&&d.append(this.format(this.info_template,{amount:c.length}));for(var f=0;f<c.length;f++){var g=this.blogData[c[f].ref-1];d.append(this.format(this.result_template,g)),e.push(g)}this.onComplete&&this.onComplete(e)},clear:function(){a(this.results).empty(),this.target.val("")},format:function(a,b){return a.replace(/{{([^{}]*)}}/g,function(a,c){var d=b[c];return"string"==typeof d||"number"==typeof d?d:a})}}}(jQuery);